65537	 	EXTDEF	BUFFER,EUFEND,LENGTH
65537	 	EXTREF	RDREC,WRREC
0	FIRST	STL	RETADR
3	CLOOP	+JSUB	RDREC
7	 	LDA	LENGTH
10	 	COMP	#0
13	 	JEQ	ENDFIL
16	 	+JSUB	WRREC
20	 	J	CLOOP
23	ENDFIL	LDA	=C'EOF'
26	 	STA	BUFFER
29	 	LDA	#3
32	 	STA	LENGTH
35	 	+JSUB	WRREC
39	 	J	@RETADR
42	RETADR	RESW	1
45	LENGTH	RESW	1
65537	 	LTORG	
48	BUFFER	RESB	4096
4144	BUFEND	EQU	*
0	RDREC	CSECT	
65537	 	EXTREF	BUFFER,LENGTH,BUFEND
0	 	CLEAR	X
2	 	CLEAR	A
4	 	CLEAR	S
6	 	LDT	MAXLEN
9	RLOOP	TD	INPUT
12	 	JEQ	RLOOP
15	 	RD	INPUT
18	 	COMPR	A,S
20	 	JEQ	EXIT
23	 	+STCH	BUFFER,X
27	 	TIXR	T
29	 	JLT	RLOOP
32	EXIT	+STX	LENGTH
36	 	RSUB	
39	INPUT	BYTE	X'F1'
0	WRREC	CSECT	
65537	 	EXTREF	LENGTH,BUFFER
0	 	CLEAR	X
2	 	+LDT	LENGTH
6	WLOOP	TD	=X'05'
9	 	JEQ	WLOOP
12	 	+LDCH	BUFFER,X
16	 	WD	=X'05'
19	 	TIXR	T
21	 	JLT	WLOOP
24	 	RSUB	
65537	 	END	FIRST
